<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Web Engineer BD</title>
    <!-- আইকন এবং ফন্ট লোড করা হচ্ছে -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* বেসিক স্টাইল এবং লেআউট ডিজাইন */
        * { box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f4f6f9; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* বাম পাশের সাইডবার ডিজাইন */
        .sidebar { width: 260px; background: #050a12; color: #fff; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; flex-shrink: 0; }
        .sidebar h2 { text-align: center; color: #2d9cdb; margin-bottom: 20px; font-size: 20px; }
        .menu-item { padding: 12px 15px; margin-bottom: 5px; cursor: pointer; border-radius: 8px; color: #b0b0b0; display: flex; align-items: center; gap: 10px; font-size: 14px; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: #2d9cdb; color: #fff; }
        
        /* ডান পাশের কনটেন্ট এরিয়া */
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .panel { display: none; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .panel.active { display: block; animation: fadeIn 0.3s; }
        
        /* ইনপুট ফিল্ড এবং বাটন ডিজাইন */
        h3 { border-bottom: 2px solid #2d9cdb; padding-bottom: 10px; display: inline-block; margin-top: 0; color: #333; }
        label { display: block; margin: 15px 0 5px; font-weight: 600; color: #555; font-size: 14px; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; margin-bottom: 10px; }
        
        .btn { background: #2d9cdb; color: #fff; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-top: 10px; transition: 0.3s; }
        .btn:hover { background: #1a7bb5; }
        .btn-red { background: #e74c3c; } .btn-red:hover { background: #c0392b; }
        .btn-yellow { background: #f1c40f; color: #333; } .btn-yellow:hover { background: #d4ac0d; }

        .loading { display: none; color: #2d9cdb; margin-left: 10px; font-weight: bold; }
        hr { border: 0; border-top: 1px solid #eee; margin: 30px 0; }
        
        /* ডাটা লিস্ট (আপডেটেড কোড) */
.data-list { margin-top: 30px; border: 1px solid #eee; border-radius: 8px; overflow: hidden; }
.list-item { 
    padding: 10px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    border-bottom: 1px solid #eee; 
    background: #fff; 
    gap: 15px; /* বাটন এবং টেক্সটের মাঝে গ্যাপ রাখবে */
}
.list-item:last-child { border-bottom: none; }
.item-info { 
    display: flex; 
    align-items: center; 
    gap: 15px; 
    min-width: 0; /* ফ্লেক্স বক্সের ভেতরে টেক্সট ভাঙার জন্য জরুরি */
    flex: 1; 
}
.item-info div { 
    word-break: break-all; /* বড় লিঙ্ক বা টেক্সট থাকলে তা ভেঙে নিচে পাঠিয়ে দিবে */
    font-size: 14px; 
}
.item-info img { width: 40px; height: 40px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; flex-shrink: 0; }
.action-grp { 
    display: flex; 
    gap: 5px; 
    flex-shrink: 0; /* বাটনগুলো যেন ছোট বা অদৃশ্য না হয়ে যায় */
}
.action-grp button { padding: 5px 10px; font-size: 12px; margin-top: 0; white-space: nowrap; }
        /* DASHBOARD CARD */
        .dash-card { background: linear-gradient(135deg, #2d9cdb, #1a7bb5); color: white; padding: 30px; border-radius: 15px; display: inline-block; min-width: 250px; text-align: center; box-shadow: 0 10px 20px rgba(45,156,219,0.3); }
        .dash-card h1 { font-size: 4rem; margin: 10px 0; font-weight: 800; }
        .dash-card p { font-size: 1.2rem; margin: 0; opacity: 0.9; }

        @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }

        /* Login Screen Style */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050a12; display: flex; align-items: center; justify-content: center; z-index: 99999; }
        .login-box { background: #fff; padding: 40px; border-radius: 12px; width: 90%; max-width: 380px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); text-align: center; }
        .login-box h2 { color: #2d9cdb; margin-bottom: 20px; font-size: 24px; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; }
        #adminApp { display: none; width: 100%; height: 100vh; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar { width: 100%; height: auto; padding: 10px; }
            .content { padding: 15px; overflow: visible; }
            .dash-card { width: 100%; min-width: auto; }
            .list-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .action-grp { width: 100%; justify-content: flex-end; }
        }
    </style>
</head>
<body>

    <!-- লগইন স্ক্রিন -->
    <div id="loginOverlay">
        <div class="login-box">
            <i class="fas fa-user-shield" style="font-size: 50px; color: #2d9cdb; margin-bottom: 15px;"></i>
            <h2>Admin Login</h2>
            <input type="email" id="loginEmail" placeholder="Admin Email">
            <input type="password" id="loginPass" placeholder="Password">
            <button class="btn" style="width: 100%;" onclick="handleLogin()">Login</button>
            <p id="loginError" style="color: red; margin-top: 10px; font-size: 13px; display: none;"></p>
        </div>
    </div>

    <!-- মূল অ্যাপ্লিকেশন কন্টেইনার -->
    <div id="adminApp">
        <div class="sidebar">
            <h2>Admin Panel</h2>
            <div class="menu-item active" onclick="switchTab('dashboardPanel')"><i class="fas fa-chart-line"></i> Dashboard</div>
            <div class="menu-item" onclick="switchTab('heroPanel')"><i class="fas fa-home"></i> Hero Section</div>
            <div class="menu-item" onclick="switchTab('servicesPanel')"><i class="fas fa-tools"></i> Services</div>
            <div class="menu-item" onclick="switchTab('catPostsPanel')"><i class="fas fa-layer-group"></i> Category Posts</div>
            <div class="menu-item" onclick="switchTab('aboutPanel')"><i class="fas fa-user"></i> About Us</div>
            <div class="menu-item" onclick="switchTab('projectsPanel')"><i class="fas fa-briefcase"></i> Projects</div>
            <div class="menu-item" onclick="switchTab('blogPanel')"><i class="fab fa-youtube"></i> Blog Posts</div>
            <div class="menu-item" onclick="switchTab('whyPanel')"><i class="fas fa-check-circle"></i> Why Choose Us</div>
            <div class="menu-item" onclick="switchTab('settingsPanel')"><i class="fas fa-cog"></i> Settings</div>
            <div class="menu-item" style="margin-top:20px; border-top:1px solid #222;" onclick="switchTab('messagesPanel')"><i class="fas fa-envelope"></i> Inbox</div>
            <div class="menu-item" onclick="handleLogout()" style="margin-top:auto; background:#e74c3c; color:white;"><i class="fas fa-sign-out-alt"></i> Logout</div>
        </div>

        <div class="content">
            <!-- DASHBOARD PANEL -->
            <div id="dashboardPanel" class="panel active">
                <h3>Website Overview</h3>
                <div style="margin-top: 30px;"><div class="dash-card"><p><i class="fas fa-users"></i> Total Visitors</p><h1 id="visitorCount">0</h1></div></div>
            </div>
            
            <!-- HERO SECTION -->
            <div id="heroPanel" class="panel">
                <h3>Update Hero Section</h3>
                <label>Title</label><input type="text" id="heroTitle">
                <label>Subtitle</label><input type="text" id="heroSubtitle">
                <label>Description</label><textarea id="heroDesc" rows="3"></textarea>
                <label>Hero Image</label><input type="file" id="heroImage">
                <button class="btn" onclick="updateHero()">Update Hero</button><span id="heroLoader" class="loading">Updating...</span>
            </div>

            <!-- SERVICES -->
            <div id="servicesPanel" class="panel">
                <h3>Manage Services</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <input type="hidden" id="svcEditKey">
                    <label>Category</label><select id="svcCategory"><option value="web">WebSite Development</option><option value="graphic">Graphic Design</option><option value="others">Others</option></select>
                    <label>Service Title</label><input type="text" id="svcTitle"><label>Icon/Image</label><input type="file" id="svcImage">
                    <button class="btn" id="svcBtn" onclick="saveService()">Add Service</button>
                    <button class="btn btn-red" onclick="resetForm('svc')" style="display:none;" id="svcCancel">Cancel</button>
                    <span id="svcLoader" class="loading">Processing...</span>
                </div>
                <h4>Existing Services</h4><div class="data-list" id="servicesList">Loading...</div>
            </div>

            <!-- CATEGORY POSTS -->
            <div id="catPostsPanel" class="panel">
                <h3>Add Details to Services</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <input type="hidden" id="cpEditKey">
                    <label>Select Parent Service</label><select id="cpParentService"><option>Loading services...</option></select>
                    <label>Post Title</label><input type="text" id="cpTitle"><label>Image</label><input type="file" id="cpImage">
                    <button class="btn" id="cpBtn" onclick="saveCategoryPost()">Add Post</button>
                    <button class="btn btn-red" onclick="resetForm('cp')" style="display:none;" id="cpCancel">Cancel</button>
                    <span id="cpLoader" class="loading">Processing...</span>
                </div>
                <h4>Existing Category Posts</h4><div class="data-list" id="catPostsList">Loading...</div>
            </div>

            <!-- BLOG POSTS -->
            <div id="blogPanel" class="panel">
                <h3>Add Blog Post</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <input type="hidden" id="blogEditKey">
                    <label>Post Type</label><select id="blogType"><option value="youtube">YouTube Video</option><option value="facebook">Facebook Link</option></select>
                    <label>Post Title</label><input type="text" id="blogTitle"><label>Post Link</label><input type="text" id="blogLink" placeholder="https://...">
                    <label>Custom Thumbnail</label><input type="file" id="blogImage">
                    <button class="btn" id="blogBtn" onclick="saveBlog()">Add Post</button>
                    <button class="btn btn-red" onclick="resetForm('blog')" style="display:none;" id="blogCancel">Cancel</button>
                    <span id="blogLoader" class="loading">Processing...</span>
                </div>
                <h4>Existing Blog Posts</h4><div class="data-list" id="blogList">Loading...</div>
            </div>

            <!-- ABOUT US -->
            <div id="aboutPanel" class="panel">
                <h3>Update About Us</h3>
                <label>Title</label><input type="text" id="aboutTitle"><label>Subtitle</label><input type="text" id="aboutSub">
                <label>Description</label><textarea id="aboutDesc" rows="5"></textarea><label>Side Image</label><input type="file" id="aboutImage">
                <button class="btn" onclick="updateAbout()">Update About Section</button><span id="aboutLoader" class="loading">Updating...</span>
            </div>

            <!-- PROJECTS -->
            <div id="projectsPanel" class="panel">
                <h3>Manage Projects</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <input type="hidden" id="projEditKey">
                    <label>Status</label><select id="projCategory"><option value="complete">Completed</option><option value="running">Running</option><option value="upcoming">Upcoming</option></select>
                    <label>Project Name</label><input type="text" id="projTitle"><label>Screenshot</label><input type="file" id="projImage">
                    <button class="btn" id="projBtn" onclick="saveProject()">Add Project</button>
                    <button class="btn btn-red" onclick="resetForm('proj')" style="display:none;" id="projCancel">Cancel</button>
                    <span id="projLoader" class="loading">Processing...</span>
                </div>
                <h4>Existing Projects</h4><div class="data-list" id="projectsList">Loading...</div>
            </div>

            <!-- WHY CHOOSE US -->
            <div id="whyPanel" class="panel">
                <h3>1. Speciality Cards</h3>
                <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                    <input type="hidden" id="specEditKey"><label>Card Title</label><input type="text" id="specTitle"><label>Icon/Image</label><input type="file" id="specImage">
                    <button class="btn" id="specBtn" onclick="saveSpeciality()">Add Card</button>
                    <button class="btn btn-red" onclick="resetForm('spec')" style="display:none;" id="specCancel">Cancel</button>
                    <span id="specLoader" class="loading">Processing...</span>
                </div>
                <div class="data-list" id="specList">Loading...</div><hr>
                <h3>2. Update Content</h3>
                <label>Main Title</label><input type="text" id="whyTitle"><label>Description</label><textarea id="whyDesc" rows="5"></textarea>
                <label>Side Image</label><input type="file" id="whyImage"><button class="btn" onclick="updateWhyContent()">Update Content</button>
            </div>

            <!-- SETTINGS -->
            <div id="settingsPanel" class="panel">
                <h3>Site Settings</h3>
                <label>Website Logo</label><input type="file" id="siteLogo"><button class="btn" onclick="updateLogo()">Update Logo</button><hr>
                <h3>Contact Info</h3><label>Email</label><input type="text" id="contactEmail"><label>Phone</label><input type="text" id="contactPhone"><label>Address</label><input type="text" id="contactAddr"><hr>
                <h3>Social Links</h3><label>Facebook</label><input type="text" id="socFb"><label>YouTube</label><input type="text" id="socLi"><label>WhatsApp</label><input type="text" id="socGh">
                <button class="btn" onclick="updateContactInfo()">Save All Settings</button>
            </div>

            <!-- INBOX -->
            <div id="messagesPanel" class="panel"><h3>Inbox</h3><div id="inboxContainer">Loading messages...</div></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBy4OsohLvE4ar0zZpGs5Iz-qQMffdM6YE",
            authDomain: "norun-nabi-parsonal.firebaseapp.com",
            databaseURL: "https://norun-nabi-parsonal-default-rtdb.firebaseio.com",
            projectId: "norun-nabi-parsonal",
            storageBucket: "norun-nabi-parsonal.firebasestorage.app",
            messagingSenderId: "562349101076",
            appId: "1:562349101076:web:29ad3786356013ce42d701"
        };
        const IMGBB_API_KEY = "8ef301d629e27e060aa203980a4ee1bf";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // --- AUTH LOGIC ---
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminApp').style.display = 'flex';
                loadCurrentData();
                startDatabaseListeners();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
                document.getElementById('adminApp').style.display = 'none';
            }
        });

        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(e => {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('loginError').innerText = "ভুল ইমেইল বা পাসওয়ার্ড!";
            });
        }

        function handleLogout() { if(confirm("Logout?")) auth.signOut().then(()=>location.reload()); }

        // --- ALL ORIGINAL FUNCTIONS ---
        function loadCurrentData() {
            db.ref('siteStats/visitors').on('value', s => { document.getElementById('visitorCount').innerText = s.val() || 0; });
            db.ref('hero').once('value', s => { const d = s.val(); if(d){ document.getElementById('heroTitle').value = d.title || ''; document.getElementById('heroSubtitle').value = d.subtitle || ''; document.getElementById('heroDesc').value = d.desc || ''; }});
            db.ref('about').once('value', s => { const d = s.val(); if(d){ document.getElementById('aboutTitle').value = d.title || ''; document.getElementById('aboutSub').value = d.subtitle || ''; document.getElementById('aboutDesc').value = d.desc || ''; }});
            db.ref('whyChoose').once('value', s => { const d = s.val(); if(d){ document.getElementById('whyTitle').value = d.title || ''; document.getElementById('whyDesc').value = d.desc || ''; }});
            db.ref('contactInfo').once('value', s => { const d = s.val(); if(d){ document.getElementById('contactEmail').value = d.email || ''; document.getElementById('contactPhone').value = d.phone || ''; document.getElementById('contactAddr').value = d.addr || ''; }});
            db.ref('socialLinks').once('value', s => { const d = s.val(); if(d){ document.getElementById('socFb').value = d.facebook || ''; document.getElementById('socLi').value = d.linkedin || ''; document.getElementById('socGh').value = d.github || ''; }});
        }

        function startDatabaseListeners() {
            db.ref('services').on('value', s => { 
                renderList(s, 'servicesList', 'svc', 'services');
                const sel = document.getElementById('cpParentService'); sel.innerHTML = '<option value="">Select Service...</option>';
                const data = s.val(); if(data) { Object.values(data).forEach(svc => { sel.innerHTML += `<option value="${svc.title}">${svc.title}</option>`; }); }
            });
            db.ref('projects').on('value', s => renderList(s, 'projectsList', 'proj', 'projects'));
            db.ref('category_posts').on('value', s => renderList(s, 'catPostsList', 'cp', 'category_posts'));
            db.ref('speciality').on('value', s => renderList(s, 'specList', 'spec', 'speciality'));
            db.ref('blogs').on('value', s => renderList(s, 'blogList', 'blog', 'blogs'));
            db.ref('contact_messages').on('value', s => {
                const c = document.getElementById('inboxContainer'); c.innerHTML=''; const d = s.val();
                if(d) { Object.keys(d).reverse().forEach(k => { const m = d[k]; c.innerHTML += `<div style="background:#f4f6f9;padding:15px;margin-bottom:10px;border-left:4px solid #2d9cdb;border-radius:5px;"><b>${m.name}</b> (${m.email}) <button onclick="deleteItem('contact_messages/${k}')" style="float:right; color:red; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button><br><small>${m.date}</small><br><strong>Sub: ${m.subject}</strong><p>${m.message}</p></div>`; });
                } else c.innerHTML='No messages.';
            });
        }

        function switchTab(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
            if(window.innerWidth < 768) window.scrollTo({top:0, behavior:'smooth'});
        }

        async function uploadImage(id) {
            const input = document.getElementById(id); if (!input.files[0]) return null;
            const formData = new FormData(); formData.append("image", input.files[0]);
            try { let res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData }); let data = await res.json(); return data.success ? data.data.url : null;
            } catch (e) { alert("Upload Failed"); return null; }
        }

        async function saveService() {
            const key = document.getElementById('svcEditKey').value; const title = document.getElementById('svcTitle').value; const cat = document.getElementById('svcCategory').value;
            if(!title) return; document.getElementById('svcLoader').style.display='inline'; let img = await uploadImage('svcImage');
            let data = { title: title, category: cat }; if(img) data.image = img;
            if(key) db.ref('services/' + key).update(data, () => { resetForm('svc'); alert('Updated!'); });
            else { if(!img) { alert('Image Required'); document.getElementById('svcLoader').style.display='none'; return; } data.image = img; db.ref('services').push(data, () => { resetForm('svc'); alert('Added!'); }); }
        }

        async function saveProject() {
            const key = document.getElementById('projEditKey').value; const title = document.getElementById('projTitle').value; const cat = document.getElementById('projCategory').value;
            document.getElementById('projLoader').style.display='inline'; let img = await uploadImage('projImage');
            let data = { title: title, category: cat }; if(img) data.image = img;
            if(key) db.ref('projects/' + key).update(data, () => { resetForm('proj'); alert('Updated!'); });
            else { if(!img) { alert('Image Required'); document.getElementById('projLoader').style.display='none'; return; } data.image = img; db.ref('projects').push(data, () => { resetForm('proj'); alert('Added!'); }); }
        }

        async function saveCategoryPost() {
            const key = document.getElementById('cpEditKey').value; const parent = document.getElementById('cpParentService').value; const title = document.getElementById('cpTitle').value;
            if(!parent || !title) return; document.getElementById('cpLoader').style.display='inline'; let img = await uploadImage('cpImage');
            let data = { title: title, parent_service: parent }; if(img) data.image = img;
            if(key) db.ref('category_posts/' + key).update(data, () => { resetForm('cp'); alert('Updated!'); });
            else { if(!img) { alert('Image Required'); document.getElementById('cpLoader').style.display='none'; return; } data.image = img; db.ref('category_posts').push(data, () => { resetForm('cp'); alert('Added!'); }); }
        }

        async function saveBlog() {
            const key = document.getElementById('blogEditKey').value; const title = document.getElementById('blogTitle').value; const type = document.getElementById('blogType').value; const link = document.getElementById('blogLink').value;
            if(!title || !link) return; document.getElementById('blogLoader').style.display='inline'; let img = await uploadImage('blogImage');
            let data = { title: title, type: type, link: link }; if(img) data.image = img; 
            if(key) db.ref('blogs/' + key).update(data, () => { resetForm('blog'); alert('Updated!'); });
            else { db.ref('blogs').push(data, () => { resetForm('blog'); alert('Added!'); }); }
        }

        async function saveSpeciality() {
            const key = document.getElementById('specEditKey').value; const title = document.getElementById('specTitle').value;
            document.getElementById('specLoader').style.display='inline'; let img = await uploadImage('specImage');
            let data = { title: title }; if(img) data.image = img;
            if(key) db.ref('speciality/' + key).update(data, () => { resetForm('spec'); alert('Updated!'); });
            else { if(!img) { alert('Image Required'); document.getElementById('specLoader').style.display='none'; return; } data.image = img; db.ref('speciality').push(data, () => { resetForm('spec'); alert('Added!'); }); }
        }

        function resetForm(prefix) {
            document.getElementById(prefix+'EditKey').value = ''; document.getElementById(prefix+'Title').value = '';
            if(document.getElementById(prefix+'Image')) document.getElementById(prefix+'Image').value = '';
            if(document.getElementById(prefix+'Link')) document.getElementById(prefix+'Link').value = '';
            document.getElementById(prefix+'Btn').innerText = 'Add New';
            document.getElementById(prefix+'Cancel').style.display = 'none'; document.getElementById(prefix+'Loader').style.display = 'none';
        }

        function deleteItem(path) { if(confirm("Are you sure?")) db.ref(path).remove(); }

        function editItem(prefix, key, title, cat, img, link) {
            document.getElementById(prefix+'EditKey').value = key; document.getElementById(prefix+'Title').value = title;
            if(prefix === 'svc' || prefix === 'proj') document.getElementById(prefix+'Category').value = cat;
            if(prefix === 'cp') document.getElementById('cpParentService').value = cat;
            if(prefix === 'blog') { document.getElementById('blogType').value = cat; document.getElementById('blogLink').value = link; }
            document.getElementById(prefix+'Btn').innerText = 'Update Item'; document.getElementById(prefix+'Cancel').style.display = 'inline-block';
            document.getElementById(prefix+'Btn').scrollIntoView({behavior: "smooth"});
        }

        function renderList(snap, containerId, prefix, path) {
            const list = document.getElementById(containerId); list.innerHTML = ''; const data = snap.val();
            if(data) { Object.keys(data).forEach(key => {
                const item = data[key]; const titleEsc = item.title ? item.title.replace(/'/g, "\\'") : '';
                let extraParam = (prefix==='cp') ? item.parent_service : (item.category || ''); 
                if(prefix==='blog') extraParam = item.type; let linkParam = (prefix==='blog') ? `', '${item.link || ''}` : '';
                let thumb = item.image || 'https://via.placeholder.com/40';
                list.innerHTML += `<div class="list-item"><div class="item-info"><img src="${thumb}"><div><strong>${item.title}</strong><br><small>${extraParam}</small></div></div><div class="action-grp"><button class="btn-yellow" onclick="editItem('${prefix}', '${key}', '${titleEsc}', '${extraParam}', null${linkParam})">Edit</button><button class="btn-red" onclick="deleteItem('${path}/${key}')">Del</button></div></div>`;
            }); } else { list.innerHTML = '<p>No items found.</p>'; }
        }

        async function updateHero() { document.getElementById('heroLoader').style.display='inline'; let img = await uploadImage('heroImage'); let data = { title: document.getElementById('heroTitle').value, subtitle: document.getElementById('heroSubtitle').value, desc: document.getElementById('heroDesc').value }; if(img) data.image=img; db.ref('hero').update(data, ()=> {document.getElementById('heroLoader').style.display='none';alert("Updated!");}); }
        async function updateAbout() { document.getElementById('aboutLoader').style.display='inline'; let img=await uploadImage('aboutImage'); let data={title:document.getElementById('aboutTitle').value, subtitle:document.getElementById('aboutSub').value, desc:document.getElementById('aboutDesc').value}; if(img) data.image=img; db.ref('about').update(data, ()=>{document.getElementById('aboutLoader').style.display='none';alert("Updated!");}); }
        async function updateWhyContent() { document.getElementById('whyLoader').style.display='inline'; let img=await uploadImage('whyImage'); let data={title:document.getElementById('whyTitle').value, desc:document.getElementById('whyDesc').value}; if(img) data.image=img; db.ref('whyChoose').update(data, ()=>{document.getElementById('whyLoader').style.display='none';alert("Updated!");}); }
        async function updateLogo() { document.getElementById('logoLoader').style.display='inline'; let img=await uploadImage('siteLogo'); if(img) db.ref('siteConfig/logo').set(img, ()=>{document.getElementById('logoLoader').style.display='none';alert("Logo Updated!");}); }
        function updateContactInfo() { db.ref('contactInfo').set({ email:document.getElementById('contactEmail').value, phone:document.getElementById('contactPhone').value, addr:document.getElementById('contactAddr').value }); db.ref('socialLinks').set({ facebook: document.getElementById('socFb').value, linkedin: document.getElementById('socLi').value, github: document.getElementById('socGh').value }, ()=>alert("Saved!")); }
    </script>
</body>
</html>
